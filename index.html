<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=3.0">
  <title>isolated.png</title>
  <link rel="icon" type="image/png" href="/thumbs/isolatedlogotransparentb2048.png">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      overflow: hidden;
      background-color: #0f0f0f;
      background-image: radial-gradient(#222 1px, transparent 1px);
      background-size: 20px 20px;
    }
    .menu-button { /* ... rimane come prima */ }
    .sound-wave { /* ... */ }
    .dropdown-menu { /* ... */ }
    .workspace { /* ... */ }
    .canvas { /* ... */ }
    .tile { /* ... */ }
    .error-placeholder { /* ... */ }

    /* LOADING overlay */
    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: #9b59b6; /* Viola */
      font-family: 'Orbitron', sans-serif;
      font-size: 32px;
      letter-spacing: 4px;
      text-shadow: 0 0 20px rgba(155, 89, 182, 0.7);
      animation: loadingPulse 1.2s ease-in-out infinite;
    }
    @keyframes loadingPulse {
      0%, 100% { opacity: 0.7; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
    }
  </style>
</head>
<body>

  <div id="loadingOverlay">LOADING...</div>

  <div class="menu-button" id="menuButton">
    <div class="sound-wave">
      <span></span><span></span><span></span><span></span><span></span>
    </div>
  </div>

  <div class="dropdown-menu" id="menu">
    <ul>
      <li><a href="/isolatedspace/">Isolated Space</a></li>
      <li><a href="/commercial/">Showcase</a></li>
      <li><a href="/workflows/">Soon/.</a></li>
      <li><a href="/socials/">Socials, contact</a></li>
      <li><a href="/about/">About</a></li>
    </ul>
    <button class="close-btn">✕</button>
  </div>

  <div class="workspace">
    <div class="canvas" id="canvas"></div>
  </div>

  <script>
    const frameColors = ['#6ecf9f', '#8aa9ff', '#d88aff', '#ff8ab3', '#ffd88a'];
    const works = [
      { type: 'image', src: '/thumbs/image1.png' },
      { type: 'video', src: '/thumbs/balenciaga.mp4' },
      { type: 'video', src: '/thumbs/brds.mp4' },
      { type: 'image', src: '/thumbs/green1.png' },
      { type: 'video', src: '/thumbs/sora11.mp4' },
      { type: 'video', src: '/thumbs/sora2.mp4' },
      { type: 'video', src: '/thumbs/sora3.mp4' },
      { type: 'image', src: '/thumbs/green2.png' },
      { type: 'video', src: '/thumbs/cthulu.mp4' },
      // Aggiungi gli altri file che vuoi mostrare...
    ];

    const canvas = document.getElementById('canvas');
    let nextX = 40, nextY = 100, maxHeight = 0;
    let isMobile = window.innerWidth <= 768;
    let activeVideo = null;

    // Gestione menu
    const menuButton = document.getElementById('menuButton');
    const menu = document.getElementById('menu');
    menuButton.addEventListener('click', (e) => {
      e.stopPropagation();
      menuButton.classList.toggle('active');
      menu.classList.toggle('active');
    });
    document.querySelector('.close-btn').addEventListener('click', () => {
      menuButton.classList.remove('active');
      menu.classList.remove('active');
    });
    document.addEventListener('click', (e) => {
      if (!menu.contains(e.target) && !menuButton.contains(e.target)) {
        menu.classList.remove('active');
        menuButton.classList.remove('active');
      }
    });

    window.addEventListener('resize', () => {
      isMobile = window.innerWidth <= 768;
    });

    async function loadTileLayout() {
      try {
        const saved = localStorage.getItem('tileLayout');
        return saved ? JSON.parse(saved) : null;
      } catch (e) {
        console.warn('Failed to load tile layout from localStorage:', e);
        return null;
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const savedLayout = await loadTileLayout();
      if (savedLayout) {
        document.querySelectorAll('.tile').forEach((tile, index) => {
          if (savedLayout[index]) {
            tile.style.width = `${savedLayout[index].width}px`;
            tile.style.height = `${savedLayout[index].height}px`;
            tile.style.left = `${savedLayout[index].left}px`;
            tile.style.top = `${savedLayout[index].top}px`;
          }
        });
      }
    });

    (async function initializeTiles() {
      let layout = null;
      try {
        const res = await fetch('/tile-layout.json?t=' + Date.now());
        if (res.ok) {
          layout = await res.json();
        } else {
          console.warn('tile-layout.json fetch failed:', res.status);
        }
      } catch (err) {
        console.error('Error fetching tile-layout.json:', err);
      }

      // Creazione tiles anche se layout è null
      works.forEach((work, index) => {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.style.borderColor = frameColors[Math.floor(Math.random() * frameColors.length)];

        let content;
        if (work.type === 'image') {
          content = document.createElement('img');
          content.src = work.src;
          content.onerror = () => {
            console.error('Failed to load image: ' + work.src);
          };
        } else if (work.type === 'video') {
          content = document.createElement('video');
          content.src = work.src;
          content.loop = true;
          content.muted = true;
          content.playsInline = true;
          content.onerror = () => {
            console.error('Failed to load video: ' + work.src);
          };
        }
        tile.appendChild(content);

        // Posizionamento default se layout è null
        if (layout && layout[index]) {
          tile.style.width = `${layout[index].width}px`;
          tile.style.height = `${layout[index].height}px`;
          tile.style.left = `${layout[index].left}px`;
          tile.style.top = `${layout[index].top}px`;
        } else {
          // posizioni a griglia semplice
          const col = index % 4;
          const row = Math.floor(index / 4);
          const w = 300, h = 200;
          tile.style.width = `${w}px`;
          tile.style.height = `${h}px`;
          tile.style.left = `${40 + col * (w + 20)}px`;
          tile.style.top = `${100 + row * (h + 20)}px`;
        }

        canvas.appendChild(tile);
      });

      // Rimuovi overlay loading sempre
      const loadingOverlay = document.getElementById('loadingOverlay');
      if (loadingOverlay) {
        loadingOverlay.style.transition = 'opacity 0.4s ease';
        loadingOverlay.style.opacity = '0';
        setTimeout(() => {
          if (loadingOverlay.parentNode) loadingOverlay.parentNode.removeChild(loadingOverlay);
        }, 400);
      }
    })();
  </script>
</body>
</html>
